<html>
    <head>
        <title>Evolution</title>
    </head>
    <body>
        <canvas id="game-canvas" width="960" height="720"></canvas>
        <script src="js/objects.js"></script>
        <script>
            var App = {
                canvas: null,
                c_cxt: null,
                fps: 30,
                panSpeed: 3,
                world: null,
                keys: {
                    w: false,
                    a: false,
                    s: false,
                    d: false
                },

                initialize: function() {
                    this.canvas = document.getElementById('game-canvas');
                    this.c_cxt = this.canvas.getContext('2d');
                    this.initControls();
                    this.initWorld();
                    setInterval(this.update.bind(this), 1000/this.fps);
                },

                initControls: function() {
                    this.canvas.addEventListener('wheel', this.handleScroll.bind(this));
                    document.addEventListener('keydown', this.handleWASD.bind(this));
                    document.addEventListener('keyup', this.handleWASD.bind(this));
                },

                initWorld: function() {
                    this.world = new World(this.c_cxt, 2000, 2000);
                    this.world.initCamera(this.canvas.width, this.canvas.height);
                    this.world.camera.setPanSpeed(this.panSpeed);
                    var bot = new Bot(
                        this.world.width/2,
                        this.world.height/2,
                        40,
                        40,
                        this.world.width,
                        this.world.height
                    );
                    this.world.addObject(bot);
                    this.addWalls();
                },

                addWalls: function() {
                    var block = 200;
                    var width = 10;
                    for (var i=0;i<100;i++) {
                        var x = i % width;
                        var y = Math.floor(i/width);
                        this.world.addObject(new Wall(
                            Math.random() * block + (block*x),
                            Math.random() * block + (block*y),
                            Math.random() * (100 - 20) + 20,
                            Math.random() * (100 - 20) + 20,
                            this.world.width,
                            this.world.height
                        ));
                    }
                },

                update: function() {
                    this.world.camera.move(
                        this.keys.w,
                        this.keys.a,
                        this.keys.s,
                        this.keys.d
                    );
                    this.world.render();
                },

                handleScroll: function(e) {

                },

                handleWASD: function(e) {
                    if (!this.keys.hasOwnProperty(e.key)) {
                        return;
                    }
                    this.keys[e.key] = e.type == 'keydown';
                },
            };
            window.onload=function() {
                App.initialize();
            }
        </script>
    </body>
</html>
